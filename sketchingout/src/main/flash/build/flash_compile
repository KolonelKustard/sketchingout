#!/bin/bash 
#
# This script should be used as the Flash Compiler on OS X. It is not needed on Windows.
#
# It invokes Flash MX 2004 with the JSFL file passed in as the first argument.
# Before invoking Flash, the script must
#   - Convert paths in the JSFL script to start with the Mac HD volume name
#   - Convert the path to to the JSFL script itself to start with the Mac HD volume name, and use colons as path separators 
echo "Compiling with JSFL file: " $1;

# Use magic to get the name of the default volume
# NOTE: if your source code isn't on the default volume, you may have to edit the grep command
#  to look for a different Mountpoint
vol=`/usr/sbin/disktool -l | /usr/bin/grep "Mountpoint = '/'" | /usr/bin/perl -e 'print $1 if (<STDIN> =~ /volName = .(.*)../ ) ;'`
echo "Volume = " $vol ;

# Copy the JSFL file to file2.jsfl, prepending the volume name into file:/// URLs
newfile=${1/\./2.}
perl -e "while(<STDIN>){ s#file:///#file:///${vol}/#g; print; }" < $1 > $newfile

# Create a colon-separated path to the new JSFL file
jsfl_path="${vol}${newfile//\//:}"
echo "jsfl_path = $jsfl_path"

# Use AppleScript to tell Flash MX 2004 to read the JSFL file
osascript -e "tell application \"Flash\" to open alias \"$jsfl_path\""

